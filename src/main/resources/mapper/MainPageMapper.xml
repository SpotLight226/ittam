<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ittam.web.mainPage.service.MainPageMapper">
    <select id="getUsereqNum" resultType="integer">
        select count(*) from USER_REQUEST where USERQ_YN = '사원사용요청'
    </select>
    <select id="getBuyNum" resultType="integer">
        select count(*) from USER_REQUEST where USERQ_YN = '사원구매요청'
    </select>
    <select id="getYetOkNum">
        select count(*) from STOCK_RETURN where return_status = '승인대기'
    </select>
    <select id="getLeaveReq">
        select count(*) from USER where USER_LEAVE_YN = 'Y'
    </select>
    <insert id="registReturnReq">
        insert into STOCK_RETURN(assets_num, username, return_kind, return_title, return_comment) values(#{assets_num}, #{username}, #{return_kind}, #{return_title}, #{return_comment});
    </insert>
    <select id="getReturnList" resultType="map">
        select * from STOCK_RETURN as sr
            left join ITASSETS as it on sr.ASSETS_NUM = it.ASSETS_NUM
            left join USER as us on sr.username = us.username
            ORDER BY RETURN_DATE DESC;
    </select>
    <select id="getSelectAssetList">
        SELECT *
        FROM ITASSETS a
                 LEFT JOIN PCSPEC pc ON (a.assets_name LIKE '%노트북%' OR a.assets_name LIKE '%데스크탑%') AND a.spec_num = pc.spec_num
                 LEFT JOIN SWSPEC sw ON (a.assets_name LIKE '%Microsoft Office%' OR a.assets_name LIKE '%파워포인트%' OR a.assets_name LIKE '엑셀' OR a.assets_name LIKE '워드' OR a.assets_name LIKE '한글과컴퓨터' OR a.assets_name LIKE '인텔리제이' ) AND a.spec_num = sw.spec_num
                 LEFT JOIN SERVERSPEC sv ON (a.assets_name LIKE '%서버용하드%') AND a.spec_num = sv.spec_num
                 LEFT JOIN ETCSPEC etc ON a.spec_num = etc.spec_num AND a.assets_name NOT LIKE '%노트북%' AND a.assets_name NOT LIKE '%데스크탑%' AND a.assets_name NOT LIKE '%서버용하드%' AND a.assets_name NOT LIKE '%Microsoft Office%' AND a.assets_name NOT LIKE '%파워포인트%' AND a.assets_name NOT LIKE '%워드%' AND a.assets_name NOT LIKE '%한글과컴퓨터%' AND a.assets_name NOT LIKE '%인텔리제이%'
                 LEFT JOIN STOCK_RETURN sr on a.ASSETS_NUM = sr.ASSETS_NUM
        where a.CATEGORY_NUM= #{category_num} and a.ASSETS_STATUS = '사용가능';
    </select>
    <select id="getUserInfo" resultType="UserVO">
        select * from USER where username = #{username}
    </select>
    <update id="modifyProfile">
        update USER set user_name=#{user_name}, user_phone=#{user_phone}, user_address=#{user_address}, user_email=#{user_email} where username = #{username};
    </update>
    <select id="getUserCnt_using">
        select count(*) from ITASSETS where username=#{username}
    </select>
    <select id="getUserCnt_exchange">
        select count(*) from STOCK_RETURN where return_kind='교환' and RETURN_STATUS='승인대기' and username=#{username}
    </select>
    <select id="getUserCnt_return">
        select count(*) from STOCK_RETURN where return_kind='반납' and RETURN_STATUS='승인대기' and username=#{username}
    </select>
    <select id="getUserCnt_usingReq">
        select count(*) from USER_REQUEST where USERQ_YN = '사원사용요청' and username=#{username}
    </select>
    <select id="getUserCnt_buyReq">
        select count(*) from USER_REQUEST where USERQ_YN = '사원구매요청' and username=#{username}
    </select>
    <select id="getMyAssetList">
        SELECT *
        FROM ITASSETS a
                 LEFT JOIN PCSPEC pc ON (a.assets_name LIKE '%노트북%' OR a.assets_name LIKE '%데스크탑%') AND a.spec_num = pc.spec_num
                 LEFT JOIN SWSPEC sw ON (a.assets_name LIKE '%Microsoft Office%' OR a.assets_name LIKE '%파워포인트%' OR a.assets_name LIKE '엑셀' OR a.assets_name LIKE '워드' OR a.assets_name LIKE '한글과컴퓨터' OR a.assets_name LIKE '인텔리제이' ) AND a.spec_num = sw.spec_num
                 LEFT JOIN SERVERSPEC sv ON (a.assets_name LIKE '%서버용하드%') AND a.spec_num = sv.spec_num
                 LEFT JOIN ETCSPEC etc ON a.spec_num = etc.spec_num AND a.assets_name NOT LIKE '%노트북%' AND a.assets_name NOT LIKE '%데스크탑%' AND a.assets_name NOT LIKE '%서버용하드%' AND a.assets_name NOT LIKE '%Microsoft Office%' AND a.assets_name NOT LIKE '%파워포인트%' AND a.assets_name NOT LIKE '%워드%' AND a.assets_name NOT LIKE '%한글과컴퓨터%' AND a.assets_name NOT LIKE '%인텔리제이%'
                 LEFT JOIN STOCK_RETURN sr on a.ASSETS_NUM = sr.ASSETS_NUM
        where a.username=#{username}
    </select>

    <update id="updateReturn_yn">
        update STOCK_RETURN set return_status = #{return_status} where return_num = #{return_num}

    </update>

    <update id="updateAssetUsing">
        update ITASSETS set ASSETS_STATUS = '사용가능', username = '' where ASSETS_NUM = #{assets_num}
    </update>


    <delete id="deleteCancelReq">
        delete from STOCK_RETURN where RETURN_NUM = #{return_num}
    </delete>

    <select id="getAssetChartAllNum">
        SELECT
            SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 6 DAY) THEN 1 ELSE 0 END) AS day6,
            SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 5 DAY) THEN 1 ELSE 0 END) AS day5,
            SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 4 DAY) THEN 1 ELSE 0 END) AS day4,
            SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 3 DAY) THEN 1 ELSE 0 END) AS day3,
            SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 2 DAY) THEN 1 ELSE 0 END) AS day2,
            SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 1 DAY) THEN 1 ELSE 0 END) AS day1,
            SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 0 DAY) THEN 1 ELSE 0 END) AS today
        FROM ITASSETS where ASSETS_STATUS = '사용중' OR ASSETS_STATUS='사용가능';

--         SELECT
--         SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 6 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 5 DAY) THEN 1 ELSE 0 END) AS day6,
--         SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 5 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 4 DAY) THEN 1 ELSE 0 END) AS day5,
--         SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 4 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 3 DAY) THEN 1 ELSE 0 END) AS day4,
--         SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 3 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 2 DAY) THEN 1 ELSE 0 END) AS day3,
--         SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 2 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 1 DAY) THEN 1 ELSE 0 END) AS day2,
--         SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 1 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 0 DAY) THEN 1 ELSE 0 END) AS day1,
--         SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 0 DAY) THEN 1 ELSE 0 END) AS today
--         FROM ITASSETS
--         WHERE ASSETS_STATUS = '사용중' or ASSETS_STATUS = '사용가능'

    </select>

    <select id="getAssetChartUsingNum">
        SELECT
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 6 DAY) THEN 1 ELSE 0 END) AS day6,
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 5 DAY) THEN 1 ELSE 0 END) AS day5,
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 4 DAY) THEN 1 ELSE 0 END) AS day4,
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 3 DAY) THEN 1 ELSE 0 END) AS day3,
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 2 DAY) THEN 1 ELSE 0 END) AS day2,
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 1 DAY) THEN 1 ELSE 0 END) AS day1,
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 0 DAY) THEN 1 ELSE 0 END) AS today
        FROM ITASSETS where ASSETS_STATUS = '사용중'

--             SELECT
--                 SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 6 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 5 DAY) THEN 1 ELSE 0 END) AS day6,
--                 SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 5 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 4 DAY) THEN 1 ELSE 0 END) AS day5,
--                 SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 4 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 3 DAY) THEN 1 ELSE 0 END) AS day4,
--                 SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 3 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 2 DAY) THEN 1 ELSE 0 END) AS day3,
--                 SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 2 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 1 DAY) THEN 1 ELSE 0 END) AS day2,
--                 SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 1 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 0 DAY) THEN 1 ELSE 0 END) AS day1,
--                 SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 0 DAY) THEN 1 ELSE 0 END) AS today
--             FROM ITASSETS
--             WHERE ASSETS_STATUS = '사용중'
    </select>

    <select id="getAssetChartDisposeNum">
        SELECT
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 6 DAY) THEN 1 ELSE 0 END) AS day6,
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 5 DAY) THEN 1 ELSE 0 END) AS day5,
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 4 DAY) THEN 1 ELSE 0 END) AS day4,
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 3 DAY) THEN 1 ELSE 0 END) AS day3,
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 2 DAY) THEN 1 ELSE 0 END) AS day2,
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 1 DAY) THEN 1 ELSE 0 END) AS day1,
        SUM(CASE WHEN ADD_DATE <![CDATA[<=]]> DATE_SUB(NOW(), INTERVAL 0 DAY) THEN 1 ELSE 0 END) AS today
        FROM ITASSETS where ASSETS_STATUS = '폐기'

--         SELECT
--             SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 6 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 5 DAY) THEN 1 ELSE 0 END) AS day6,
--             SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 5 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 4 DAY) THEN 1 ELSE 0 END) AS day5,
--             SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 4 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 3 DAY) THEN 1 ELSE 0 END) AS day4,
--             SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 3 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 2 DAY) THEN 1 ELSE 0 END) AS day3,
--             SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 2 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 1 DAY) THEN 1 ELSE 0 END) AS day2,
--             SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 1 DAY) AND ADD_DATE <![CDATA[<]]> DATE_SUB(NOW(), INTERVAL 0 DAY) THEN 1 ELSE 0 END) AS day1,
--             SUM(CASE WHEN ADD_DATE <![CDATA[>=]]> DATE_SUB(NOW(), INTERVAL 0 DAY) THEN 1 ELSE 0 END) AS today
--         FROM ITASSETS
--         WHERE ASSETS_STATUS = '폐기'
    </select>

    <update id="exchangeAsset_exchange">
        update ITASSETS set assets_status='사용중', username=#{username}, rent_date=now() where assets_num = #{assets_num_later}
    </update>

    <update id="exchangeAsset_cancel">
        update ITASSETS set assets_status='사용가능', username="" where assets_num = #{assets_num_now}
    </update>
    <update id="exchangeAsset_assetlog">
        update STOCK_RETURN set RETURN_ASSETS_DETAIL_NAME=#{assets_detail_name_later} where return_num = #{return_num}
    </update>
    <select id="getMyRequestList">
        select * from USER_REQUEST where username = #{username} ORDER BY userq_regdate DESC;
    </select>
    <delete id="deleteUsingPerchaseReq">
        delete from USER_REQUEST where userq_num = #{userq_num}
    </delete>
    <update id="registLeaveReq">
        update USER set USER_LEAVE_YN = 'Y', USER_LEAVEDATE = now() where username = #{username}
    </update>
    <select id="getMyPcCnt">
        select count(*) from ITASSETS as it
        left join GROUP_CATEGORY as gc on it.CATEGORY_NUM = gc.CATEGORY_NUM
        where username = #{username} and CATEGORY_PARENT_NUM = 1;
    </select>
    <select id="getMySwCnt">
        select count(*) from ITASSETS as it
        left join GROUP_CATEGORY as gc on it.CATEGORY_NUM = gc.CATEGORY_NUM
        where username = #{username} and CATEGORY_PARENT_NUM = 2;
    </select>
    <select id="getMyEtcCnt">
        select count(*) from ITASSETS as it
        left join GROUP_CATEGORY as gc on it.CATEGORY_NUM = gc.CATEGORY_NUM
        where username = #{username} and CATEGORY_PARENT_NUM = 3;
    </select>
    <select id="getMyServerCnt">
        select count(*) from ITASSETS as it
        left join GROUP_CATEGORY as gc on it.CATEGORY_NUM = gc.CATEGORY_NUM
        where username = #{username} and CATEGORY_PARENT_NUM = 4;
    </select>
    <select id="getRecentAssetsList">
        select * from ITASSETS a
                          LEFT JOIN GROUP_CATEGORY gc on a.CATEGORY_NUM = gc.CATEGORY_NUM
                          LEFT JOIN PCSPEC pc ON (a.assets_name LIKE '%노트북%' OR a.assets_name LIKE '%데스크탑%') AND a.spec_num = pc.spec_num
                          LEFT JOIN SWSPEC sw ON (a.assets_name LIKE '%Microsoft Office%' OR a.assets_name LIKE '%파워포인트%' OR a.assets_name LIKE '엑셀' OR a.assets_name LIKE '워드' OR a.assets_name LIKE '한글과컴퓨터' OR a.assets_name LIKE '인텔리제이' ) AND a.spec_num = sw.spec_num
                          LEFT JOIN SERVERSPEC sv ON (a.assets_name LIKE '%서버용하드%') AND a.spec_num = sv.spec_num
                          LEFT JOIN ETCSPEC etc ON a.spec_num = etc.spec_num AND a.assets_name NOT LIKE '%노트북%' AND a.assets_name NOT LIKE '%데스크탑%' AND a.assets_name NOT LIKE '%서버용하드%' AND a.assets_name NOT LIKE '%Microsoft Office%' AND a.assets_name NOT LIKE '%파워포인트%' AND a.assets_name NOT LIKE '%워드%' AND a.assets_name NOT LIKE '%한글과컴퓨터%' AND a.assets_name NOT LIKE '%인텔리제이%'
        order by add_date desc limit #{nnn};
    </select>
    <select id="getNoticeList">
        SELECT * FROM NOTICE order by NOTICE_REGDATE desc limit 5;
    </select>



</mapper>